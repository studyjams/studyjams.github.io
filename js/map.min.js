(function(){(function(){"use strict";var app;app=void 0,app=angular.module("StudyJams",["ocupop","ui.directives"]),app.factory("EventMap",function($http){var end_date,start_date,to_unix_date,url;return end_date=void 0,start_date=void 0,to_unix_date=void 0,url=void 0,to_unix_date=function(date){return Math.floor(date.valueOf()/1e3)},start_date=to_unix_date(new Date("2015-01-23")),end_date=to_unix_date(new Date("2015-12-31")),url="https://developers.google.com/events/event-markers.public?&tag=studyjam&start="+start_date+"&end="+end_date,Modernizr.cors?(url+="&callback=JSON_CALLBACK",$http.jsonp(url)):(url+="&callback=JSON_CALLBACK",$http.jsonp(url))}),app.controller("MapCtrl",function($scope,EventMap){var marker_url,_current_infobox;return $scope.map_ready=!1,marker_url=void 0,_current_infobox=void 0,marker_url=Modernizr.svg?"images/marker.svg":"images/marker.png",_current_infobox=null,$scope.searchText="",$scope.searchFilter=function(obj){var location,re;return re=new RegExp($scope.searchText,"i"),location=obj.location.replace(/,/g,""),!$scope.searchText||re.test(location)},$scope.event_map={show:"map",map_options:{center:new google.maps.LatLng(10,0),zoom:2,minZoom:2,scrollWheel:!1},map:{},events:[],resize:function(){return google.maps.event.trigger(this.map,"resize")},mark:function(event,index){var info,info_content,marker,_this;return info=void 0,info_content=void 0,marker=void 0,_this=this,marker=new google.maps.Marker({position:event.latlng,map:this.map,icon:marker_url}),event.event_url=""!==event.registration_link?event.registration_link:""!==event.gplusEventUrl?event.gplusEventUrl:"https://developers.google.com"+event.defaultEventUrl,info_content='<div class="event-infobox">\n  <h3 class="event-title">'+event.name+'</h3>\n  <p class="event-location">'+event.location+'</p>\n  <p class="to-register"><a href="'+event.event_url+'" target="_blank">Register for your local Study Jam</a></p>\n</div>',info=new InfoBox({content:info_content}),google.maps.event.addListener(marker,"click",function(){return _this.selected=index,$scope.$apply(),null!=_current_infobox&&_current_infobox.close(),_current_infobox=info,info.open(_this.map,marker)})},load:function(){var _this;return _this=this,EventMap.success(function(data){var check_index,e,index,shouldPush,u,__map,__unique,_check_i,_i,_len,_ref,_results;for($scope.map_ready=!0,e=void 0,index=void 0,_i=void 0,_len=void 0,_ref=void 0,_results=void 0,_ref=data,_this.events=[],_results=[],__unique=[],__map=[],index=_i=0,check_index=_check_i=0,_len=_ref.length,shouldPush=function(u){var i,item,_j,_len1;for(i=_j=0,_len1=__unique.length;_len1>_j;i=++_j)if(item=__unique[i],item.latlng.lat===u.latlng.lat&&item.latlng.lon===u.latlng.lon){if(item.start<u.start)return!1;__map[i]=0}return!0};_len>_check_i;)e=_ref[check_index],u={latlng:e.latlng,start:e.start},__map.push(shouldPush(u)?1:0),__unique.push(u),check_index=++_check_i;for(;_len>_i;)__map[index]>0&&(e=_ref[index],_results.push(_this.mark(e,index)),_this.events.push(e)),index=++_i;return _results}),this.resize()},clear_selected:function(){return this.selected=null},selected:null},$scope.event_map.load()}),app.filter("coerceDate",function(){return function(source){return new Date(1e3*source)}})}).call(this)}).call(this);
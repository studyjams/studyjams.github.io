<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">

<polymer-element name="my-element">
  <template>
    <span>Hello from <b>my-element</b>. This is my Shadow DOM.</span>
    <core-ajax url="../bower.json" auto response="{{resp}}"></core-ajax>
    <textarea value="{{resp}}"></textarea>
    <ul>
      <template repeat="{{s in salutations}}">
        <li>{{s.what}}: <input type="text" value="{{s.who}}"></li>
      </template>
    </ul>
    <ul>
      <template repeat="{{p in packages.data}}">
        <li>{{p.description}}</li>
      </template>
    </ul>
  </template>
  <script src="../js/papaparse.js"></script>
  <script>
    Polymer('my-element', {
      ready: function() {
        this.salutations = [
          {what: 'Hello', who: 'World'},
          {what: 'Goodbye', who: 'DOM APIs'},
          {what: 'Hello', who: 'Declarative'},
          {what: 'Goodbye', who: 'Imperative'}
        ];
        this.alternates = ['Hello', 'Hola', 'Howdy'];
        this.current = 0;

        var myElement = this;
        var file = "packages.csv";
        
        // Parse local CSV file
        Papa.parse(file, {
          download: true,
          header: true,
          /*
           * support csv files ending with empty last line · Issue #150 · mholt/PapaParse
           * https://github.com/mholt/PapaParse/issues/150
           */
          skipEmptyLines: true,
        	complete: function(results) {
        		console.log("Finished:", results);
        		myElement.packages = results;
        	}
        });

      },     
      updateModel: function() {
        this.current = (this.current + 1) % this.alternates.length;
        this.salutations[0].what = this.alternates[this.current];
      }
    });
  </script>
</polymer-element>